use lexer::Lexer;
use std::slice;


struct TestCase {
    data: String,
    expected: Vec<String>,
}

struct Test {
    test_cases: Vec<TestCase>,
}

impl Test {
    fn iter(&self) -> TestIter {
        TestIter {
            inner: self.test_cases.iter(),
        }
    }
}

struct TestIter<'a> {
    inner: slice::Iter<'a, TestCase>,
}

impl<'a> Iterator for TestIter<'a> {
    type Item = &'a TestCase;

    fn next(&mut self) -> Option<Self::Item> {
        self.inner.next()
    }
}


fn test_cases() -> Test {
    Test {
        test_cases: vec![
            TestCase {
                data: String::from(r"                              \
                    v -2.300000 1.950000 0.000000                  \
                    v -2.200000 0.790000 0.000000                  \
                    v -2.340000 -1.510000 0.000000                 \
                    v -1.530000 -1.490000 0.000000                 \
                    v -0.720000 -1.470000 0.000000                 \
                    v -0.780000 0.230000 0.000000                  \
                    v 0.070000 0.250000 0.000000                   \
                    v 0.920000 0.270000 0.000000                   \
                    v 0.800000 -1.610000 0.000000                  \
                    v 1.620000 -1.590000 0.000000                  \
                    v 2.440000 -1.570000 0.000000                  \
                    v 2.690000 0.670000 0.000000                   \
                    v 2.900000 1.980000 0.000000                   \
                    # 13 vertices                                  \
                                                                   \
                    # Multi                                        \
                    # line                                         \
                    # comment                                      \
                    cstype bezier                                  \
                    ctech cparm 1.000000                           \
                    deg 3                                          \
                    curv 0.000000 4.000000 1 2 3 4 5 6 7 8 9 10 \\ \
                    11 12 13                                       \
                    parm u 0.000000 1.000000 2.000000 3.000000  \\ \
                    4.000000                                       \
                    end                                            \
                    # 1 element                                    \
                    "
                ),
                expected: vec![
                    "v", "-2.300000", "1.950000", "0.000000",
                    "v", "-2.200000", "0.790000", "0.000000",
                    "v", "-2.340000", "-1.510000", "0.000000",
                    "v", "-1.530000", "-1.490000", "0.000000",
                    "v", "-0.720000", "-1.470000", "0.000000",
                    "v", "-0.780000", "0.230000", "0.000000",
                    "v", "0.070000", "0.250000", "0.000000",
                    "v", "0.920000", "0.270000", "0.000000",
                    "v", "0.800000", "-1.610000", "0.000000",
                    "v", "1.620000", "-1.590000", "0.000000",
                    "v", "2.440000", "-1.570000", "0.000000",
                    "v", "2.690000", "0.670000", "0.000000",
                    "v", "2.900000", "1.980000", "0.000000",
                    "cstype", "bezier",
                    "ctech", "cparm", "1.000000",
                    "deg", "3",
                    "curv", "0.000000", "4.000000", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10",
                    "11", "12", "13",
                    "parm", "u", "0.000000", "1.000000", "2.000000", "3.000000",
                    "4.000000",
                    "end"
                ].iter().map(|&str| String::from(str)).collect(),
            },
            TestCase {
                data: String::from(r"                       \
                    # diamond.obj                           \
                                                            \
                    g Object001                             \
                                                            \
                    v 0.000000E+00 0.000000E+00 78.0000     \
                    v 45.0000 45.0000 0.000000E+00          \
                    v 45.0000 -45.0000 0.000000E+00         \
                    v -45.0000 -45.0000 0.000000E+00        \
                    v -45.0000 45.0000 0.000000E+00         \
                    v 0.000000E+00 0.000000E+00 -78.0000    \
                                                            \
                    f     1 2 3                             \
                    f     1 3 4                             \
                    f     1 4 5                             \
                    f     1 5 2                             \
                    f     6 5 4                             \
                    f     6 4 3                             \
                    f     6 3 2                             \
                    f     6 2 1                             \
                    f     6 1 5                             \
                                                            \
                                                            \
                                                            \
                    "
                ),
                expected: vec![
                    "g", "Object001",
                    "v", "0.000000E+00", "0.000000E+00", "78.0000",
                    "v", "45.0000", "45.0000", "0.000000E+00",
                    "v", "45.0000", "-45.0000", "0.000000E+00",
                    "v", "-45.0000", "-45.0000", "0.000000E+00",
                    "v", "-45.0000", "45.0000",  "0.000000E+00",
                    "v", "0.000000E+00", "0.000000E+00", "-78.0000",
                    "f", "1", "2", "3",
                    "f", "1", "3", "4",
                    "f", "1", "4", "5",
                    "f", "1", "5", "2",
                    "f", "6", "5", "4",
                    "f", "6", "4", "3",
                    "f", "6", "3", "2",
                    "f", "6", "2", "1",
                    "f", "6", "1", "5",
                ].iter().map(|&str| String::from(str)).collect(),
            }
        ]
    }
}

#[test]
fn test_lexer1() {
    for test_case in test_cases().iter() {
        let lexer = Lexer::new(&test_case.data);
        let result = lexer.collect::<Vec<String>>();
        assert_eq!(result, test_case.expected);
    }
}

